<div class="test-container">
  <h2 class="text-2xl font-bold mb-4">Test d'Orientation Académique</h2>

  <div *ngIf="loading" class="text-center">
    <p>Chargement du test...</p>
  </div>

  <div *ngIf="error" class="text-red-500 text-center">
    <p>{{ error }}</p>
  </div>

  <div *ngIf="!loading && !error && currentQuestion">
    <div class="progress-bar">
      <div class="progress-bar-fill" [style.width.%]="progress">
        {{ currentQuestionIndex + 1 }} / {{ questions.length }}
      </div>
    </div>

    <form [formGroup]="testForm">
      <div class="question-card">
        <h3>{{ currentQuestion.text }}</h3>

        <div [ngSwitch]="currentQuestion.question_type">
          <!-- MCQ -->
          <div *ngSwitchCase="'mcq'" class="options-group">
            <label *ngFor="let option of currentQuestion.options; let i = index">
              <input 
                type="radio" 
                [formControlName]="'question_' + currentQuestion.id" 
                [value]="option"
              >
              {{ option }}
            </label>
          </div>

          <!-- Likert Scale -->
          <div *ngSwitchCase="'likert'" class="likert-scale">
            <label *ngFor="let value of [1, 2, 3, 4, 5]">
              <input 
                type="radio" 
                [formControlName]="'question_' + currentQuestion.id" 
                [value]="value"
              >
              {{ value }}
            </label>
          </div>

          <!-- Ranking (simplified as multiple choice for now, requires more complex UI for true ranking) -->
          <div *ngSwitchCase="'ranking'" class="options-group">
            <p>Veuillez classer par ordre de préférence (sélectionnez une option):</p>
            <label *ngFor="let option of currentQuestion.options; let i = index">
              <input 
                type="radio" 
                [formControlName]="'question_' + currentQuestion.id" 
                [value]="option"
              >
              {{ option }}
            </label>
          </div>
        </div>
        <div *ngIf="!testForm.valid && testForm.dirty" class="text-red-500">
          Veuillez sélectionner une réponse.
        </div>
      </div>
    </form>

    <div class="navigation-buttons">
      <button (click)="prevQuestion()" [disabled]="currentQuestionIndex === 0">Précédent</button>
      <button 
        *ngIf="currentQuestionIndex < questions.length - 1" 
        (click)="nextQuestion()" 
        [disabled]="!testForm.valid"
      >
        Suivant
      </button>
      <button 
        *ngIf="currentQuestionIndex === questions.length - 1" 
        (click)="finishTest()" 
        [disabled]="!testForm.valid" 
        class="finish-button"
      >
        Terminer le Test
      </button>
    </div>
  </div>

  <div *ngIf="!loading && !error && !currentQuestion && questions.length === 0" class="text-center">
    <p>Aucune question disponible pour le test d'orientation.</p>
  </div>
</div>